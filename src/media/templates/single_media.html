{% extends "core/layout.html" %}
{% load static %}


{% block javascript_global %}
{{ media_value_object.get_video_metadata_as_json|json_script:"video-meta" }}
<script>
    const videoMetadata = JSON.parse(document.getElementById("video-meta").textContent);
    const sessionKey = '{{media_value_object.get_session_key}}'
    const videoKey = '{{media_value_object.get_wrapped_master_key}}'
    const videoNonce = '{{media_value_object.get_wrap_nonce}}'
</script>
{% endblock javascript_global %}

{% block javascript_include %}
<script src="{% static 'js/media/single_media.js' %}"></script>
{% endblock javascript_include %}

{% block content %}
<div id="media-view" class="max-w-md mx-auto  "
     x-data="singleMediaComponent()">
    {% if media_value_object.is_unlocked %}
    <video
            id="my-video"
            class="video-js vjs-default-skin "
            controls
            poster="{{media_value_object.media.get_thumbnail_url}}"
            data-setup='{"fluid": true}'>
        <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a
            web browser that supports HTML5 video
        </p>
    </video>
    {% else %}
    <video
            id="my-video"
            class="video-js vjs-default-skin "
            controls
            preload="metadata"
            poster="{{media_value_object.media.get_thumbnail_url}}"
            data-setup='{"fluid": true}'>
        <source src="{{media_value_object.media.get_trailer_url}}" type="video/mp4"/>
        <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a
            web browser that supports HTML5 video
        </p>
    </video>
    <a href="#"
       class="text-white bg-success box-border border border-transparent hover:bg-success-strong focus:ring-4 focus:ring-success-medium shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">
        <i class="ri-lock-unlock-line"></i> Unlock for ${{media.unlock_price}}
    </a>
    {% endif %}

    <!-- Action anchors -->
    <div class="flex justify-around mt-4 pb-4">
        <!-- Like -->
        <a href="#"
           @click.prevent="like()"
           :class="liked ? 'text-blue-600' : 'text-blue-500'"
           class="no-underline flex flex-col items-center transform transition-transform duration-150">
            <i class="ri-thumb-up-line text-3xl" x-show="!liked"></i>
            <i class="ri-thumb-up-fill text-3xl" x-show="liked"></i>
            <span class="mt-1 text-sm" x-text="likes"></span>
        </a>

        <!-- Comment -->
        <a href="#"
           @click.prevent="comment()"
           class="no-underline flex flex-col items-center text-gray-500 transform transition-transform duration-150">
            <i class="ri-chat-3-line text-3xl"></i>
            <span class="mt-1 text-sm" x-text="comments"></span>
        </a>

        <!-- Report -->
        <a href="#"
           @click.prevent="report()"
           class="no-underline flex flex-col items-center text-red-500 hover:text-red-600 transform transition-transform duration-150">
            <i class="ri-error-warning-line text-3xl"></i>
            <span class="mt-1 text-sm">Report</span>
        </a>
    </div>
</div>

{% endblock content %}
